---
import Layout from "../layouts/Layout.astro";
---


<Layout title="Ubicación">
    <main>
        <header class="page-header">
            <h1 class="header-title">Ubicación</h1>
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="entorno">Entorno</button>
                <button class="filter-tab" data-filter="mapa">Mapa</button>
            </div>
        </header>        
        <section>
            <!-- Entorno Image -->
            <div id="entorno-content" class="content-view">
                <img src="/TODO_CHANGE_REAL_ONE_ENTORNO.png" alt="Entorno" />
            </div>

            <!-- Mapa Iframe -->
            <div id="mapa-content" class="content-view hidden">
                <iframe
                    id="map-iframe"
                    width="100%"
                    height="100%"
                    src=""
                    style="border: none;"
                    frameborder="0"
                    scrolling="no">
                </iframe>
            </div>
        </section>
    </main>
</Layout>



<style>
    body {
        overflow: hidden;
    }
    main {
    overflow: auto;
    flex: 1;
    background-color: hsl(240, 15%, 17%);
    padding: 20px;
    width: 100%;
    margin: 0 auto;
    }
    section {
        height: calc(100vh - 200px);
        max-height: 600px;
        margin: 0px;
        border-radius: 12px;
        background-position: 50% 70%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
        overflow: hidden;
    }
    img {
        height: auto;
        border-radius: 12px;
        width: 100%;
    }
    .header-title{
        font-size: 2rem;
        font-weight: 700;
        color: white;
        margin: 0;
        padding: 0;
        text-align: center;        
    }
    .page-header {
        margin-bottom: 10px;
        text-align: center;
        max-width: 1400px;
        margin-left: auto;
        margin-right: auto;
    }
    .filter-tabs {
        display: flex;
        gap: 8px;
        justify-content: center;
    }
    .filter-tab {
        padding: 12px 24px;
        border: none;
        border-radius: 4px;
        background-color: hsl(240, 15%, 30%);
        color: white;
        font-size: 0.95rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .filter-tab:hover {
        background-color: hsl(240, 15%, 35%);
    }

    .filter-tab.active {
        background-color: hsl(230, 100%, 69%);
        color: white;
    }

    .content-view {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .content-view.hidden {
        display: none;
    }

    .content-view img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 12px;
    }

    .content-view iframe {
        border-radius: 12px;
        max-height: 100%;
        overflow: hidden;
        pointer-events: auto;
    }

    @media (orientation: portrait) {
        main {
            height: calc(100dvh - 80px);
            overflow: hidden;
            padding: 0;
        }
        section {
            height: calc(100% - 80px);
            margin: 0;
            max-height: calc(100dvh - 160px);
        }
        .header-title{
            display: none;     
        }        
        .page-header {
            padding: 16px;
            margin-bottom: 0;
            max-width: none;
            margin-left: 0;
            margin-right: 0;
        }
        .filter-tabs {
            justify-content: center;
            overflow-x: auto;
            padding-bottom: 8px;
            gap: 8px;
        }
        .filter-tab {
            padding: 8px 16px;
            font-size: 0.9rem;
            white-space: nowrap;
            flex-shrink: 0;
        }               
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const filterTabs = document.querySelectorAll('.filter-tab');
    const entornoContent = document.getElementById('entorno-content');
    const mapaContent = document.getElementById('mapa-content');
    const mapIframe = document.getElementById('map-iframe');
    let mapLoaded = false;

    const mapSrc = "https://www.openstreetmap.org/export/embed.html?bbox=-8.376289%2C43.330298%2C-8.364127%2C43.335244&layer=mapnik&marker=43.33277139293852%2C-8.370208740234375";

    function showContent(filter) {
        if (filter === 'entorno') {
            entornoContent.classList.remove('hidden');
            mapaContent.classList.add('hidden');
        } else if (filter === 'mapa') {
            entornoContent.classList.add('hidden');
            mapaContent.classList.remove('hidden');

            // Load the map only when it becomes visible
            if (!mapLoaded) {
                mapIframe.src = mapSrc;
                mapLoaded = true;
            }
        }
    }

    function updateActiveTab(activeTab) {
        filterTabs.forEach(tab => {
            tab.classList.remove('active');
        });
        activeTab.classList.add('active');
    }

    filterTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const filter = this.dataset.filter;
            updateActiveTab(this);
            showContent(filter);
        });
    });

    // Initialize with "Entorno" selected
    showContent('entorno');
});
</script>
